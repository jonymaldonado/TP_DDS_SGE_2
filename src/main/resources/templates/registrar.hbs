{{#partial "contenido"}}

<header>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"></script>

</header>
	<h3>Usuario Nuevo</h3>
	

<form class="form-horizontal" role="form"  action="/usuario/create"  method="POST">
	<div class="row">
	    <div class="col-md-12">
	        <div class="col-md-2">
	            <label>Nombre Usuario</label>
	        </div>
	        <div class="col-md-4">
	            <input type="text" class="form-control" id="nombre_usuario" name="nombre_usuario" placeholder="Ingrese el nombre de usuario" required>
	        </div>
	        <div class="col-md-2">
	            <label>Contrase&ntildea</label>
	        </div>
	        <div class="col-md-4">
	            <input type="password" class="form-control" id="contrasenia" name="contrasenia" placeholder="Ingrese su contrasenia" required>
	        </div>        
	    </div>
	</div>
	<br>
	<div class="row">
	    <div class="col-md-12">
	        <div class="col-md-2">
	            <label>Nombre</label>
	        </div>
	        <div class="col-md-4">
	            <input type="text" class="form-control" id="nombre" name="nombre" placeholder="Nombre" required>
	        </div>
	        <div class="col-md-2">
	            <label>Apellido</label>
	        </div>
	        <div class="col-md-4">
	            <input type="text" class="form-control" id="apellido" name="apellido" placeholder="Apellido" required>
	        </div>        
	    </div>
	</div>
	<br>
	<div class="row">
	    <div class="col-md-12">
	        <div class="col-md-2">
	            <label>Tipo Documento</label>
	        </div>
	        <div class="col-md-4">
	            <select class="form-control" name="tipo_documento" placeholder="Seleccione el tipo de documento">
			      	<option value="dni">DNI</option> 
			  		<option value="pasaporte">Pasaporte</option>
		      	</select>
	        </div>
	        <div class="col-md-2">
	            <label>Numero Documento</label>
	        </div>
	        <div class="col-md-4">
	            <input type="number" class="form-control" id="numero_documento" name="numero_documento" placeholder="Ingrese el numero del documento" required>
	        </div>        
	    </div>
	</div>
	<br>
   	<div class="row">
	    <div class="col-md-12">
	        <div class="col-md-2">
	            <label>Telefono</label>
	        </div>
	        <div class="col-md-4">
	            <input type="number" class="form-control" id="telefono" name="telefono" placeholder="Ingrese su numero telefonico" required>
	        </div>     
	    </div>
	</div>
	<br>
  	
	<div class="row">
	<h3>Domicilio</h3>
	    <div class="col-md-12">
	        <div class="col-md-2">
	            <label>Domicilio</label>
	        </div>
	        <div class="col-md-4">
	            <input type="text" class="form-control" id="calle" name="calle" placeholder="Ingrese su domicilio" required>
	        </div>
	        <div class="col-md-2">
	            <label>Numero</label>
	        </div>
	        <div class="col-md-4">
	            <input type="number" class="form-control" id="numero_calle" name="numero_calle" placeholder="Ingrese el numero del documento" required>
	        </div>        
	    </div>
	</div>
	<br>
  	
	<div class="row">
	    <div class="col-md-12">
	        <div class="col-md-2">
	            <label>Piso</label>
	        </div>
	        <div class="col-md-4">
	            <input type="number" class="form-control" id="piso" name="piso" placeholder="Ingrese el piso">
	        </div>
	        <div class="col-md-2">
	            <label>Departamento</label>
	        </div>
	        <div class="col-md-4">
	            <input type="text" class="form-control" id="departamento"  name="departamento" placeholder="Ingrese el departamento">
	        </div>        
	    </div>
	</div>
	<br><br>
	<input type="hidden" id="latitude" name="latitude">
	<input type="hidden" id="longitude" name="longitude">

	<div class="form-group mapa">
		<div id="mapa" style="height: 500px"></div>
	</div>
	<br><br>
	<div class="form-group">
		<div style="float:right">
			<button style="float:right" type="button" onclick="window.history.back()" class="btn btn-danger"><i class="fa fa-arrow-left"></i> Volver</button>
			<button class="btn btn-primary">Guardar</button>
		</div>
	</div>
</form>
<br><br> 

	

<script type="text/javascript">

	$( document ).ready(function() {
		jQuery.noConflict(); 
		verificarDomicilio();
		
		
		mapa = L.map('mapa', {
	    center: [-34.598313, -58.463745],
	    zoom: 10,  
	    minZoom: 4,
	    maxZoom:17,
	    zoomControl:true 
		});
		L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
	    attribution: ''}).addTo(mapa);
		
		$('.mapa').hide();
		
	});
	
	$("#calle").on('keyup', function(){
        verificarDomicilio();
    }).keyup();
	
	$("#numero_calle").on('keyup', function(){
        verificarDomicilio();
    }).keyup();
    
	function verificarDomicilio(){
		var domicilio = $("#calle").val();
		var numero_domicilio = $("#numero_calle").val();
		
		if(domicilio !=="" && numero_domicilio !==""){
			codeAddress();
		}else{
			$('.mapa').hide();
		}
	}
	
	function codeAddress() {
	    var calle = $("#calle").val();
	    var numero = $("#numero_calle").val();
	   
	    addr = "caba,"+calle+","+numero;
	    myForwardGeocode(addr);
  	}
  
  
  function myForwardGeocode(addr)
  { 	
	$.ajax({
          type: "GET",
          url: "https://api.opencagedata.com/geocode/v1/json?q="+encodeURIComponent(addr)+"&key=4f2e8ad1d18f451793dd42490f6156e1&no_annotations=1&language=es", 
          dataType: "json",
          success: function(data){
          
              if (data.status.code==200)
              {
                  if (data.total_results>=1)
                  {
                      var latres = data.results[0].geometry.lat;
                      var lngres = data.results[0].geometry.lng;
                      $("#latitude").val(latres).trigger("chosen:updated");
		              $("#longitude").val(lngres).trigger("chosen:updated");
                      $('.mapa').show();
  		              mapa.setZoom(20);
  		              mapa.setView([latres,lngres]);
					  L.marker([latres, lngres]).addTo(mapa);
		              var finalText = '<div id="info_window">' + addr + '<br/><strong>Latitud:</strong> ' + Math.round(latres*1000000)/1000000 + ' | <strong>Longitud:</strong> ' + Math.round(lngres*1000000)/1000000 + bookmark() + '</div>';
		              openBubble({lat:latres, lng:lngres}, finalText);
		              
		              //bookUp(document.getElementById("address").value, latres, lngres);
		    		  //ddversdms();
		    		  
                  }
                  else
                  {
                      alert("Error de codificación geográfica");
                  }
              }
              else
              {
                  alert("Error de codificación geográfica");
              }
          },
          error: function(xhr, err){
              alert("Error de codificación geográfica");
          }
      });
  }
</script>

{{/partial}}
{{>base.hbs}}